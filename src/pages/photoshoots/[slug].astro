---
import MainLayout from '../../layouts/MainLayout.astro';
import { fetchPhotoshoots, fetchPhotoshootBySlug, fetchKepka, getAssetUrl } from '../../lib/directus';
import { CloudinaryImage } from '../../components/ui/CloudinaryImage';

export async function getStaticPaths() {
  const photoshoots = await fetchPhotoshoots(100); // Get a reasonable number for prerendering
  return photoshoots.map((photoshoot) => ({
    params: { slug: photoshoot.slug },
    props: { photoshoot },
  }));
}

const { photoshoot } = Astro.props;
const kepka = await fetchKepka();

// Format the date
const formattedDate = new Date(photoshoot.date_created).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<MainLayout title={photoshoot.title}>
  <main>
    {/* Hero section with Kepka data */}
    {kepka && kepka.hero_image && (
      <div class="relative h-[50vh] min-h-[400px] overflow-hidden">
        <img 
          src={getAssetUrl(kepka.hero_image)} 
          alt="Hero image"
          class="absolute inset-0 w-full h-full object-cover"
        />
        <div class="absolute inset-0 bg-black/50 flex items-center">
          <div class="container mx-auto px-6 lg:px-16">
            <h1 class="text-5xl md:text-6xl font-display font-bold tracking-tighter mb-6 text-white">
              {photoshoot.title}
            </h1>
            {kepka.description && (
              <div class="max-w-2xl text-white/90 prose prose-invert" set:html={kepka.description} />
            )}
          </div>
        </div>
      </div>
    )}

    <div class="container mx-auto px-6 lg:px-16 py-12">
      <header class="mb-12">
        {!kepka || !kepka.hero_image ? (
          <>
            <h1 class="text-5xl md:text-6xl font-display font-bold tracking-tighter mb-4">
              {photoshoot.title}
            </h1>
            <div class="w-24 h-1 bg-electric-red mb-8"></div>
          </>
        ) : (
          <div class="w-24 h-1 bg-electric-red mb-8"></div>
        )}
        
        <time class="text-lg opacity-75 block mb-6" datetime={photoshoot.date_created}>
          {formattedDate}
        </time>
        
        {photoshoot.description && (
          <div class="prose prose-lg max-w-none mb-12" set:html={photoshoot.description} />
        )}
      </header>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {photoshoot.images.map((imageUrl: string) => (
          <a 
            href={imageUrl} 
            class="block aspect-[3/4] overflow-hidden hover:border-electric-red transition-all duration-300"
            target="_blank"
            rel="noopener"
          >
            <CloudinaryImage 
              publicId={imageUrl} 
              alt={`${photoshoot.title} - Photo`}
              className="w-full h-full object-cover transition-all duration-500"
              grayscale={false}
              crop="fill"
              gravity="auto"
              fallback={imageUrl}
              client:load
            />
          </a>
        ))}
      </div>
      
      <div class="mt-16 pt-8 border-t border-foreground/10">
        <a 
          href="/photoshoots" 
          class="inline-flex items-center gap-2 font-medium hover:text-electric-red transition-colors"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
          </svg>
          Back to All Photoshoots
        </a>
      </div>
    </div>
  </main>
</MainLayout> 