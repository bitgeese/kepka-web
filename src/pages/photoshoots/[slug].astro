---
import MainLayout from '../../layouts/MainLayout.astro';
import { fetchPhotoshootBySlug, getAssetUrl } from '../../lib/directus';
import { CloudinaryImage } from '../../components/ui/CloudinaryImage';
import directus from "../../lib/directus";
import { readItems } from "@directus/sdk";

// The Photoshoot type isn't exported directly, recreate it here
interface Photoshoot {
  id?: string;
  images: string[];
  title: string;
  description: string;
  date_created: string;
  slug: string;
}

export async function getStaticPaths() {
  // Fetch photoshoots directly from Directus
  const photoshoots = await directus.request(
    readItems('kepka_shoots', {
      fields: ['*', 'images.directus_files_id'],
      sort: ['-date_created'],
      limit: 100,
    })
  );
  
  // Map photoshoots to paths and pass the entire photoshoot object as props
  return photoshoots.map((photoshoot) => ({
    params: { slug: photoshoot.slug },
    props: { photoshoot },
  }));
}

// Get the photoshoot from props
const { photoshoot } = Astro.props;

// Format the date
const formattedDate = new Date(photoshoot.date_created).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<MainLayout title={photoshoot.title}>
  <main>
    <div class="container mx-auto px-6 lg:px-16 py-12">
      <header class="mb-12">
        <h1 class="text-5xl md:text-6xl font-display font-bold tracking-tighter mb-4">
          {photoshoot.title}
        </h1>
        <div class="w-24 h-1 bg-electric-red mb-8"></div>
        
        <time class="text-lg opacity-75 block mb-6" datetime={photoshoot.date_created}>
          {formattedDate}
        </time>
        
        {photoshoot.description && (
          <div class="prose prose-lg max-w-none mb-12" set:html={photoshoot.description} />
        )}
      </header>
      
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
        {photoshoot.images.map((image) => {
          const imageUrl = typeof image === 'string' ? image : getAssetUrl(image);
          return (
            <div class="aspect-square overflow-hidden">
              <CloudinaryImage
                publicId={imageUrl}
                alt={photoshoot.title}
                className="w-full h-full object-cover"
                grayscale={false}
                crop="fill"
                gravity="auto" 
                fallback={imageUrl}
                client:load
              />
            </div>
          );
        })}
      </div>
      
      <div class="mt-16 pt-8 border-t border-foreground/10">
        <a 
          href="/photoshoots" 
          class="inline-flex items-center gap-2 font-medium hover:text-electric-red transition-colors"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
          </svg>
          Back to All Photoshoots
        </a>
      </div>
    </div>
  </main>
</MainLayout> 